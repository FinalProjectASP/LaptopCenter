@using LaptopCenter.Constraints;
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<section class="my-5">
    <div class="container profile mt-0">
        <div class="main-body">
            <div class="row">
                <div class="col-lg-4 pt-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center text-center">
                                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQtbEsykx-0fhTred6UwHDYtMFd2UgTJCG4gaklT1dx4suRO4_n5LJr4Gg28kquSX5fpNo&usqp=CAU" alt="Admin"
                                     class="rounded-circle p-1 bg-warning" width="110">
                                <div class="mt-3">
                                    <h4>Jyoti</h4>
                                    <p class="text-secondary mb-1">+91 7493658737</p>   
                                    <p class="text-muted font-size-sm">Delhi, NCR</p>
                                </div>

                                <div class="cart_buttons">
                                    <a asp-controller="Authentication" asp-action="Index" class="button cart_button_clear">
                                        Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div id="tabs">
                        <input type="radio" id="button-1" name="tab" checked>
                        <input type="radio" id="button-2" name="tab">
                        <input type="radio" id="button-3" name="tab">

                        <ul class="tab-profile">
                            <li>
                                <label for="button-1">Profile</label>
                            </li>
                            <li>
                                <label for="button-2">Purchase order</label>
                            </li>
                            <li>
                                <label for="button-3">Purchase history</label>
                            </li>
                            <li class="bg">
                            </li>
                        </ul>

                        <div id="shadow">
                            <div id="content">
                                <div id="tab-1 pt-0">
                                    <div class="card-body pt-0">
                                        <div class="row mt-4">
                                            <div class="col">
                                                <p class="text-muted mb-2">Customer Name</p>
                                                <hr class="mt-0">
                                            </div>
                                            <div class="col">
                                                <p class="text-muted mb-2">Telephone</p>
                                                <hr class="mt-0">
                                            </div>
                                            <div class="col">
                                                <p class="text-muted mb-2">Address</p>
                                                <hr class="mt-0">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="card-name" class="small-text text-muted mb-1">Old Password</label>
                                            <input type="text" class="form-control form-control-sm" name="card-name" id="card-name" aria-describedby="helpId" placeholder="Enter Old Password">
                                        </div>
                                        <div class="form-group">
                                            <label for="card-number" class="small-text text-muted mb-1">New Password</label>
                                            <input type="text" class="form-control form-control-sm" name="card-number" id="card-number" aria-describedby="helpId" placeholder="New Old Password">
                                        </div>                                        
                                    </div>
                                </div>
                                <!-- Tab 2: Current Orders -->
                                <div id="tab-2" class="order-profile p-0">
                                    <div class="cart_items order-profile">
                                        <div class="cart_title">
                                            Your order
                                            <small> (@ViewBag.Ordered.Count item(s))</small>
                                        </div>
                                        @if (ViewBag.Ordered != null && ViewBag.Ordered.Count > 0)
                                        {
                                            @for (int i = 0; i < ViewBag.Ordered.Count; i++)
                                            {
                                                var statusClass = "";
                                                var status = (EStatus)ViewBag.Ordered[i].Order.Status;

                                                switch (status)
                                                {
                                                    case EStatus.Pending:
                                                        statusClass = "text-warning alert alert-warning"; // yellow for pending
                                                        break;
                                                    case EStatus.Processing:
                                                        statusClass = "text-info alert alert-info"; // blue for processing
                                                        break;
                                                    case EStatus.Completed:
                                                        statusClass = "text-success alert alert-success"; // green for completed
                                                        break;
                                                }

                                                <ul class="cart_list ps-0">
                                                    <li class="alert p-2 w-100 mb-0 @statusClass" role="alert">
                                                        <h6 class="mb-0"><b>@status</b></h6>
                                                        <p class="hidden-sm-down mb-0">
                                                            Est. delivery between
                                                            @ViewBag.Ordered[i].Order.OrderDate.ToString("MMMM dd") –
                                                            @ViewBag.Ordered[i].Order.DeliveryDate.ToString("MMMM dd, yyyy")
                                                        </p>
                                                        <div class="cart_info_col text-end" onclick="toggleInfo(@ViewBag.Ordered[i].Order.OrderId)">
                                                            <a id="btn-@ViewBag.Ordered[i].Order.OrderId" class="btn btn-sm btn-warning seemore_btn">See more</a>
                                                        </div>
                                                    </li>
                                                    <li class="ps-2" id="show-@ViewBag.Ordered[i].Order.OrderId" style="display: none;">
                                                        <h6 class="mb-0 mt-3">
                                                            <b>Customer Name:</b>
                                                            @ViewBag.Ordered[i].Order.CustomerName
                                                        </h6>
                                                        <h6 class="mb-0 mt-2">
                                                            <b>Customer Phone:</b>
                                                            @ViewBag.Ordered[i].Order.CustomerPhone
                                                        </h6>
                                                        <h6 class="mb-0 mt-2">
                                                            <b>Delivery Local:</b>
                                                            @ViewBag.Ordered[i].Order.DeleveryLocal
                                                        </h6>
                                                    </li>
                                                    @foreach (var item in ViewBag.Ordered[i].Details)
                                                    {
                                                        <li class="cart_item ps-4 clearfix">
                                                            <div class="cart_item_image">
                                                                <img src="~/img/products/@item.Product.ProductImage" alt="Product Image">
                                                            </div>
                                                            <div class="cart_item_info d-flex flex-md-row flex-column justify-content-between">
                                                                <div class="cart_item_name cart_info_col">
                                                                    <div class="cart_item_title">Name</div>
                                                                    <div class="cart_item_text cart_name">@item.Product.ProductName</div>
                                                                </div>
                                                                <div class="cart_item_price cart_info_col">
                                                                    <div class="cart_item_title">Price</div>
                                                                    <div class="cart_item_text cart_price">$@item.Product.Price</div>
                                                                </div>
                                                                <div class="cart_item_quantity cart_info_col">
                                                                    <div class="cart_item_title">Quantity</div>
                                                                    <div class="cart_item_text cart_price">@item.OrderDetail.Quantity</div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    }
                                                    <li>
                                                        <h6 class="margin_total text-end">
                                                            <b>Total:</b>
                                                            $@ViewBag.Ordered[i].Order.Total
                                                        </h6>
                                                    </li>
                                                </ul>
                                            }
                                        }
                                    </div>
                                </div>

                                <!-- Tab 3: Order History -->
                                <div id="tab-3" class="order-profile p-0">
                                    <div class="cart_items order-profile">
                                        @if (ViewBag.History != null && ViewBag.History.Count > 0)
                                        {
                                            @for (int i = 0; i < ViewBag.History.Count; i++)
                                            {
                                                var statusClass = "";
                                                var status = (EStatus)ViewBag.History[i].Order.Status;

                                                switch (status)
                                                {
                                                    case EStatus.Pending:
                                                        statusClass = "text-warning alert alert-warning"; // yellow for pending
                                                        break;
                                                    case EStatus.Processing:
                                                        statusClass = "text-info alert alert-info"; // blue for processing
                                                        break;
                                                    case EStatus.Completed:
                                                        statusClass = "text-success alert alert-success"; // green for completed
                                                        break;
                                                }

                                                <ul class="cart_list ps-0">
                                                    <li class="alert p-2 w-100 mb-0 @statusClass" role="alert">
                                                        <h6 class="mb-0"><b>@status</b></h6>
                                                        <p class="hidden-sm-down mt-3 mb-0">
                                                            Est. delivery between
                                                            @ViewBag.History[i].Order.OrderDate.ToString("MMMM dd") –
                                                            @ViewBag.History[i].Order.DeliveryDate.ToString("MMMM dd, yyyy")
                                                        </p>
                                                        <h6 class="mb-0 mt-3">
                                                            <b>Customer Name:</b>
                                                            @ViewBag.History[i].Order.CustomerName
                                                        </h6>
                                                        <h6 class="mb-0 mt-2">
                                                            <b>Customer Phone:</b>
                                                            @ViewBag.History[i].Order.CustomerPhone
                                                        </h6>
                                                        <h6 class="mb-0 mt-2">
                                                            <b>Delivery Local:</b>
                                                            @ViewBag.History[i].Order.DeleveryLocal
                                                        </h6>
                                                    </li>
                                                    @foreach (var item in ViewBag.History[i].Details)
                                                    {
                                                        <li class="cart_item ps-4 clearfix">
                                                            <div class="cart_item_image">
                                                                <img src="~/img/products/@item.Product.ProductImage" alt="Product Image">
                                                            </div>
                                                            <div class="cart_item_info d-flex flex-md-row flex-column justify-content-between">
                                                                <div class="cart_item_name cart_info_col">
                                                                    <div class="cart_item_title">Name</div>
                                                                    <div class="cart_item_text cart_name">@item.Product.ProductName</div>
                                                                </div>
                                                                <div class="cart_item_price cart_info_col">
                                                                    <div class="cart_item_title">Price</div>
                                                                    <div class="cart_item_text cart_price">$@item.Product.Price</div>
                                                                </div>
                                                                <div class="cart_item_quantity cart_info_col">
                                                                    <div class="cart_item_title">Quantity</div>
                                                                    <div class="cart_item_text cart_price">@item.OrderDetail.Quantity</div>
                                                                </div>
                                                                @if (item.Reviews != null)
                                                                {
                                                                    <div class="cart_item_color cart_info_col">
                                                                        <a asp-controller="Reviews" asp-action="Details" asp-route-id="@item.Reviews.Id">See review</a>
                                                                    </div>
                                                                }
                                                                else
                                                                {
                                                                    <div class="cart_item_color cart_info_col">
                                                                        <a asp-controller="Reviews" asp-action="Create" asp-route-productId="@item.Product.ProductId" asp-route-orderId="@ViewBag.History[i].Order.OrderId">Review</a>
                                                                    </div>
                                                                }
                                                            </div>
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                        }
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function toggleInfo(orderId) {
        var infoElement = document.getElementById('show-' + orderId);
        var btn = document.getElementById('btn-' + orderId);

        if (infoElement.style.display === "none") {
            infoElement.style.display = "block";
            btn.textContent = "See less";
        } else {
            infoElement.style.display = "none";
            btn.textContent = "See more";
        }
    }
</script>
